// Easy Parallax plugin for jQuery 
// =============
// Author : David Richart
// v1.0.0 created the September, 4th 2016
// Plugin licensed under the CC BY-ND 2.0 license
// Git webpage : https://github.com/davidrichart/jquery-easyparallax
// Description: A lightweight, easy-to-use, jQuery plugin for adding a simple vertical parallax background
!function(a){a.fn.easyParallax=function(e){var t=this,l={debug:!1,alignment:"center",effectAmount:400,effectThreshold:0,isReady:function(a){}},n=a.extend(l,e);n.debug&&(console.log("EasyParallax | INIT | Plugin launched"),console.log("EasyParallax | INIT | Main parameters loaded : debug : '"+n.debug+"', alignment : '"+n.alignment+"', effectAmount : '"+n.effectAmount+"', effectThreshold : '"+n.effectThreshold+"'"));var r=function(a,e,t){var i;return function(){var l=this,n=arguments,r=function(){i=null,t||a.apply(l,n)},s=t&&!i;clearTimeout(i),i=setTimeout(r,e||200),s&&a.apply(l,n)}},s=function(a){var e=a.find(".easyparallax"),i=a.width(),l=a.height();if(t.parallaxActived())var l=l+n.effectAmount;var r=i/l,s=e.find("img").get(0).naturalWidth,o=e.find("img").get(0).naturalHeight,c=s/o,d=iHeight=0;switch(c>r?(iHeight=parentHeight=l,d=s*l/o):r>c?(d=i,iHeight=o*i/s):(d=i,iHeight=l),e.css("width",d),e.css("height",iHeight),n.alignment){case"left":e.css("left",0);break;case"center":var g=Math.ceil((d-i)/2);e.css("left",-g);break;case"right":var g=Math.ceil(d-i);e.css("left",-g)}};return this.getCorrectBg=function(e){var t=a(window).innerWidth(),l=!1;for(i in e)t>=i&&(l=e[i]);return l},this.parallaxActived=function(){var e=a(window).innerWidth();return e>n.effectThreshold?!0:!1},this.moveBg=function(e){var i=e.find(".easyparallax");if(t.parallaxActived()){var l=a(window).scrollTop(),n=a(window).scrollTop()+a(window).height(),r=e.position().top,s=r+e.height(),o=s-r+a(window).height();if(n>=r&&s>=l){var c=100*(n-r)/o;c=Math.round(c),0>c?c=0:c>100&&(c=100);var d=i.height(),g=e.height(),f=d-g,u=-(f*c/100);i.css("top",u)}}else i.css("top","0")},this.each(function(){var e=a(this);e.css("position","relative"),e.css("overflow","hidden");var i=a(this).attr("class"),l=a(this).data(),o=[],c="";for(var d in l)if("bg"==d.substr(0,2)){var g=d.substr(2);g=""==g?0:parseInt(g),a.isNumeric(g)?o[g]=[l[d]]:n.debug&&console.log("EasyParallax | INIT | Element : '"+i+"' | '"+d+"' attribut isn't well-formed")}if(!o[0])return void(n.debug&&console.log("EasyParallax | ERROR | Element : '"+i+"' | 'data-bg' attribut is missing"));e.prepend('<div class="easyparallax"><img src alt="bg parallax" title="bg parallax" style="width:100%; height:100%;"></div>'),e.find(".easyparallax").css("position","absolute"),e.find(".easyparallax").css("top","0"),e.find(".easyparallax").css("left","0"),n.debug&&console.log("EasyParallax | INIT | Element : '"+i+"' | Parallax structure created");var f=t.getCorrectBg(o);c=f,e.find(".easyparallax img").on("load",function(){n.debug&&console.log("EasyParallax | INIT | Element : '"+i+"' | Loaded image : '"+f+"'"),n.isReady.call(e.find(".easyparallax")),s(e),t.moveBg(e)}).on("error",function(){n.debug&&0!=f&&console.log("EasyParallax | ERROR | Element : '"+i+"' | Image '"+f+"' doesn't exist")}).attr("src",f),a(window).on("resize",r(function(){var a=t.getCorrectBg(o);a!=c?(c=a,e.find(".easyparallax img").on("load",function(){n.debug&&console.log("EasyParallax | INIT | Element : '"+i+"' | Loaded image : '"+a+"'"),s(e)}).on("error",function(){n.debug&&0!=a&&console.log("EasyParallax | ERROR | Element : '"+i+"' | Image '"+a+"' doesn't exist")}).attr("src",a)):s(e)},100)),a(window).scroll(function(){t.moveBg(e)})})}}(jQuery);